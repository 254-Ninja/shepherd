<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">test/unit/tour.spec.js | Shepherd</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Guide your users through a tour of your app."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Shepherd"><meta property="twitter:description" content="Guide your users through a tour of your app."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/shipshapecode/shepherd.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#js">js</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/evented.js~Evented.html">Evented</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/modal.js~Modal.html">Modal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/step.js~Step.html">Step</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/js/tour.js~Tour.html">Tour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Shepherd">Shepherd</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">test/unit/tour.spec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import _ from &apos;lodash&apos;;
import { stub } from &apos;sinon&apos;;
import Shepherd from &apos;../../src/js/shepherd.js&apos;;
import { Step } from &apos;../../src/js/step.js&apos;;
import tippy from &apos;tippy.js&apos;;
import { defaults as tooltipDefaults } from &apos;../../src/js/utils/tooltip-defaults&apos;;
import { spy } from &apos;sinon&apos;;
import { drop, rewire$drop, restore } from &apos;../../src/js/utils/general&apos;;

// since importing non UMD, needs assignment
window.Shepherd = Shepherd;

const DEFAULT_STEP_CLASS = &apos;shepherd-step-tooltip&apos;;

describe(&apos;Tour | Top-Level Class&apos;, function() {
  let instance, shouldShowStep;

  const defaultStepOptions = {
    classes: DEFAULT_STEP_CLASS,
    scrollTo: true
  };

  beforeEach(() =&gt; {
    tippy.setDefaults({ duration: 0, delay: 0 });
  });

  afterEach(() =&gt; {
    instance.complete();
  });

  describe(&apos;constructor&apos;, function() {
    it(&apos;creates a new tour instance&apos;, function() {
      instance = new Shepherd.Tour({ defaultStepOptions });

      expect(instance instanceof Shepherd.Tour).toBe(true);
    });

    it(&apos;returns the default options on the instance&apos;, function() {
      instance = new Shepherd.Tour({ defaultStepOptions });

      expect(instance.options.defaultStepOptions).toEqual({
        classes: DEFAULT_STEP_CLASS,
        scrollTo: true
      });
    });

    it(&apos;sets the correct bindings&apos;, function() {
      instance = new Shepherd.Tour({ defaultStepOptions });

      const bindings = Object.keys(instance.bindings);
      const tourEvents = [&apos;complete&apos;, &apos;cancel&apos;, &apos;start&apos;, &apos;show&apos;, &apos;active&apos;, &apos;inactive&apos;];
      // Check that all bindings are included
      const difference = _.difference(tourEvents, bindings);
      expect(difference.length, &apos;all tour events bound&apos;).toBe(0);
    });

    it(&apos;sets defaults for tippy&apos;, function() {
      const tourSpy = spy(Shepherd.Tour.prototype, &apos;_setTooltipDefaults&apos;);
      const tippySpy = spy(tippy, &apos;setDefaults&apos;);

      expect(tourSpy.callCount).toBe(0);
      expect(tippySpy.callCount).toBe(0);

      instance = new Shepherd.Tour({ defaultStepOptions });

      expect(tourSpy.callCount).toBe(1);
      expect(tippySpy.callCount).toBe(1);
      expect(tippySpy.calledWith(tooltipDefaults)).toBe(true);
    });

    it(&apos;generates a unique `id` property, optionally based upon the `tourName` option&apos;, function() {
      const instance1 = new Shepherd.Tour();
      const instance2 = new Shepherd.Tour({ tourName: &apos;select-avatar&apos; });

      expect(instance1.id.startsWith(&apos;tour--&apos;)).toBe(true);
      expect(instance2.id.startsWith(&apos;select-avatar--&apos;)).toBe(true);

      const uniqueId1 = instance1.id.split(&apos;--&apos;)[1];
      const uniqueId2 = instance2.id.split(&apos;--&apos;)[1];

      expect(uniqueId1).not.toBe(uniqueId2);
    });
  });

  describe(&apos;methods&apos;, () =&gt; {
    beforeEach(() =&gt; {
      shouldShowStep = false;

      instance = new Shepherd.Tour({
        defaultStepOptions
      });

      instance.addStep(&apos;test&apos;, {
        id: &apos;test&apos;,
        title: &apos;This is a test step for our tour&apos;
      });

      instance.addStep(&apos;skipped-step&apos;, {
        classes: &apos;skipped&apos;,
        id: &apos;skipped-step&apos;,
        title: &apos;This step should be skipped&apos;,
        showOn() {
          return shouldShowStep;
        }
      });

      instance.addStep(&apos;test2&apos;, {
        id: &apos;test2&apos;,
        title: &apos;Another Step&apos;
      });

      instance.addStep(&apos;test3&apos;, {
        id: &apos;test3&apos;,
        title: &apos;Yet, another test step&apos;
      });
    });

    describe(&apos;.addStep()&apos;, function() {
      it(&apos;adds tour steps&apos;, function() {
        expect(instance.steps.length).toBe(4);
        expect(instance.getById(&apos;test&apos;).options.classes, &apos;classes passed to step options&apos;).toBe(DEFAULT_STEP_CLASS);
      });

      it(&apos;adds steps with only one arg&apos;, function() {
        const step = instance.addStep({
          id: &apos;one-arg&apos;
        });

        expect(instance.steps.length).toBe(5);
        expect(step.id, &apos;id applied to step with just one arg&apos;).toBe(&apos;one-arg&apos;);
      });

      it(&apos;adds steps that are already Step instances&apos;, function() {
        const step = instance.addStep(new Step(instance, {
          id: &apos;already-a-step&apos;
        }));

        expect(instance.steps.length).toBe(5);
        expect(step.id, &apos;id applied to step instance&apos;).toBe(&apos;already-a-step&apos;);
        expect(step.tour, &apos;tour is set to `this`&apos;).toBe(instance);
      });
    });

    describe(&apos;.getById()&apos;, function() {
      it(&apos;returns the step by ID with the right title&apos;, function() {
        expect(instance.steps.length).toBe(4);
        expect(instance.getById(&apos;test3&apos;).options.title).toBe(&apos;Yet, another test step&apos;);
      });
    });

    describe(&apos;.start()&apos;, function() {
      it(&apos;starts a tour that is the current active&apos;, function() {
        instance.start();

        expect(instance).toBe(Shepherd.activeTour);
      });

      it(&apos;adds the current tour\&apos;s &quot;id&quot; property to the body as a data attribute&apos;, function() {
        instance.id = &apos;test-id&apos;;
        instance.start();

        expect(document.body.hasAttribute(&apos;data-shepherd-active-tour&apos;)).toBe(true);
        expect(document.body.getAttribute(&apos;data-shepherd-active-tour&apos;)).toBe(&apos;test-id&apos;);
      });
    });

    describe(&apos;.getCurrentStep()&apos;, function() {
      it(&apos;returns the currently shown step&apos;, function() {
        instance.start();
        expect(instance.getCurrentStep().id).toBe(&apos;test&apos;);
      });
    });

    describe(&apos;.hide()&apos;, function() {
      it(&apos;hides the current step&apos;, () =&gt; {
        const firstStep = instance.steps[0];
        const hideStepSpy = spy(firstStep, &apos;hide&apos;);

        expect(firstStep.isOpen()).toBe(false);

        instance.start();

        expect(firstStep.isOpen()).toBe(true);

        instance.hide();

        expect(firstStep.isOpen()).toBe(false);
        expect(hideStepSpy.callCount).toBe(1);
      });
    });

    describe(&apos;isActive&apos;, function() {
      it(&apos;computes whether or not `Shepherd.activeTour` equals the instance&apos;, function() {
        Shepherd.activeTour = &apos;&apos;;
        expect(instance.isActive()).toBe(false);

        Shepherd.activeTour = instance;
        expect(instance.isActive()).toBe(true);

        Shepherd.activeTour = &apos;&apos;;
        expect(instance.isActive()).toBe(false);
      });
    });

    describe(&apos;.next()/.back()&apos;, function() {
      it(&apos;goes to the next/previous steps&apos;, function() {
        instance.start();
        instance.next();
        expect(instance.getCurrentStep().id).toBe(&apos;test2&apos;);
        instance.back();
        expect(instance.getCurrentStep().id).toBe(&apos;test&apos;);
      });

      it(&apos;next completes tour when on last step&apos;, function() {
        let completeFired = false;
        instance.on(&apos;complete&apos;, () =&gt; {
          completeFired = true;
        });

        instance.start();
        instance.show(&apos;test3&apos;);
        expect(instance.getCurrentStep().id).toBe(&apos;test3&apos;);
        instance.next();
        expect(completeFired, &apos;complete is called when next is clicked on last step&apos;).toBeTruthy();
      });
    });

    describe(&apos;.cancel()&apos;, function() {
      it(&apos;shows confirm dialog when confirmCancel is true&apos;, function() {
        instance = new Shepherd.Tour({
          defaultStepOptions,
          confirmCancel: true,
          confirmCancelMessage: &apos;Confirm cancel?&apos;
        });

        instance.addStep(&apos;test&apos;, {
          id: &apos;test&apos;,
          title: &apos;This is a test step for our tour&apos;
        });

        let inactiveFired = false;
        instance.on(&apos;inactive&apos;, () =&gt; {
          inactiveFired = true;
        });

        const windowConfirmStub = stub(window, &apos;confirm&apos;);
        windowConfirmStub.returns(false);

        instance.start();
        expect(instance, &apos;activeTour is set to our tour&apos;).toBe(Shepherd.activeTour);
        instance.cancel();
        expect(windowConfirmStub.called, &apos;window confirm is called&apos;).toBeTruthy();
        expect(inactiveFired, &apos;tour still going, since confirm returned false&apos;).toBeFalsy();

        windowConfirmStub.returns(true);
        instance.cancel();
        expect(windowConfirmStub.called, &apos;window confirm is called&apos;).toBeTruthy();
        expect(inactiveFired, &apos;tour inactive, since confirm returned true&apos;).toBeTruthy();
      });

      it(&apos;tears down tour on cancel&apos;, function() {
        let inactiveFired = false;
        instance.on(&apos;inactive&apos;, () =&gt; {
          inactiveFired = true;
        });
        instance.start();
        expect(instance, &apos;activeTour is set to our tour&apos;).toBe(Shepherd.activeTour);
        instance.cancel();
        expect(Shepherd.activeTour, &apos;activeTour is torn down&apos;).toBeFalsy();
        expect(inactiveFired, &apos;inactive event fired&apos;).toBeTruthy();
      });

      it(&apos;triggers cancel event when cancel function is called&apos;, function() {
        let cancelFired = false;
        instance.on(&apos;cancel&apos;, () =&gt; {
          cancelFired = true;
        });

        instance.start();
        instance.cancel();
        expect(cancelFired, &apos;cancel event fired&apos;).toBeTruthy();
      });
    });

    describe(&apos;.complete()&apos;, function() {
      it(&apos;triggers complete event when complete function is called&apos;, function() {
        let completeFired = false;

        instance.on(&apos;complete&apos;, () =&gt; {
          completeFired = true;
        });

        instance.start();
        instance.complete();
        expect(completeFired, &apos;complete event fired&apos;).toBeTruthy();
      });

      it(&apos;calls `done()`&apos;, () =&gt; {
        const doneSpy = spy(instance, &apos;done&apos;);

        expect(doneSpy.callCount).toBe(0);

        instance.start();
        instance.complete();

        expect(doneSpy.callCount).toBe(1);
      });
    });

    describe(&apos;.done()&apos;, function() {
      it(&apos;tears down the active tour&apos;, function() {
        instance.start();

        expect(instance, &apos;activeTour is set to our tour&apos;).toBe(Shepherd.activeTour);

        instance.complete();

        expect(Shepherd.activeTour, &apos;`activeTour` is torn down and removed from the `Shepherd` global&apos;).toBe(null);
      });

      it(&apos;removes any of its `Step` tooltip elements from the DOM&apos;, function() {
        const testStep = {
          id: &apos;element-removal-test&apos;,
          classes: &apos;element-removal-test&apos;,
          title: &apos;This is a test step for our tour&apos;
        };

        instance.addStep(testStep);
        instance.start();
        instance.show(&apos;element-removal-test&apos;);

        expect(document.querySelector(`.element-removal-test`),
          &apos;a step is rendered in the DOM after the tour starts&apos;)
          .toBeInTheDocument();

        instance.complete();

        expect(document.querySelector(`.element-removal-test`),
          &apos;steps are removed from the DOM after the tour completes&apos;)
          .not.toBeInTheDocument();
      });

      it(&apos;fires the `inactive` event&apos;, function() {
        let inactiveFired = false;

        instance.on(&apos;inactive&apos;, () =&gt; {
          inactiveFired = true;
        });

        instance.start();

        expect(inactiveFired, &apos;inactive event does not fire before `complete()`&apos;).toBe(false);

        instance.complete();

        expect(inactiveFired, &apos;inactive event fires after `complete()`&apos;).toBe(true);
      });
    });

    describe(&apos;.removeStep()&apos;, function() {
      it(&apos;removes the step when passed the id&apos;, function() {
        instance.start();
        expect(instance.steps.length).toBe(4);
        instance.removeStep(&apos;test2&apos;);
        expect(instance.steps.length).toBe(3);
      });

      it(&apos;hides the step before removing&apos;, function() {
        let hideFired = false;
        instance.start();
        expect(instance.steps.length).toBe(4);
        const step = instance.getById(&apos;test&apos;);
        step.on(&apos;hide&apos;, () =&gt; {
          hideFired = true;
        });
        instance.removeStep(&apos;test&apos;);
        expect(instance.steps.length).toBe(3);
        expect(hideFired, &apos;hide is fired before step is destroyed&apos;).toBeTruthy();
      });
    });

    describe(&apos;.show()&apos;, function() {
      let dropSpy;

      beforeEach(() =&gt; {
        rewire$drop(dropSpy = spy(drop));
      });

      afterEach(restore);

      it(&apos;show short-circuits if next is not found&apos;, function() {
        let showFired = false;
        instance.start();
        instance.on(&apos;show&apos;, () =&gt; {
          showFired = true;
        });
        instance.show(&apos;not-a-real-key&apos;);
        expect(showFired, &apos;showFired is false because show short circuits&apos;).toBeFalsy();
      });

      it(&apos;showOn determines which steps to skip&apos;, function() {
        instance.start();
        expect(instance.getCurrentStep().id).toBe(&apos;test&apos;);
        instance.next();
        expect(instance.getCurrentStep().id).toBe(&apos;test2&apos;);
        expect(instance.getCurrentStep().id, &apos;step skipped because `showOn` returns false&apos;).not.toBe(&apos;skipped-step&apos;);
        instance.back();
        shouldShowStep = true;
        instance.next();
        expect(instance.getCurrentStep().id, &apos;step shown because `showOn` returns true&apos;).toBe(&apos;skipped-step&apos;);

        // This spy checks that, when we call `trigger` with `show`, that we pass `arguments` down.
        const dropArguments = dropSpy.args[2][0];
        const dropReturnValue = dropSpy.returnValues[2][0];
        expect(dropArguments[0]).toBe(&apos;show&apos;);
        expect(dropArguments[1].previous).toBe(null);
        expect(dropArguments[1].step.id).toBe(&apos;test&apos;);
        expect(dropReturnValue.previous).toBe(null);
        expect(dropReturnValue.step.id).toBe(&apos;test&apos;);
      });

      it(`sets the instance on \`Shepherd.activeTour\` if it&apos;s not already set`, function() {
        const setupFuncSpy = spy(instance, &apos;_setupActiveTour&apos;);
        Shepherd.activeTour = null;

        expect(setupFuncSpy.callCount).toBe(0);

        instance.start();

        expect(setupFuncSpy.callCount).toBe(1);
        expect(Shepherd.activeTour).toBe(instance);
      });
    });
  });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
