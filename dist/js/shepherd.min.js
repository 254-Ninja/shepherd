!function(n,i){"function"==typeof define&&define.amd?define(["tether"],i):"object"==typeof exports?module.exports=i(require("tether")):n.Shepherd=i(n.Tether)}(this,function(Tether){"use strict";function n(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function i(n,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}function s(n){var i=document.createElement("div");return i.innerHTML=n,i.children[0]}function o(n,i){var s=void 0;return typeof n.matches!==w?s=n.matches:typeof n.matchesSelector!==w?s=n.matchesSelector:typeof n.msMatchesSelector!==w?s=n.msMatchesSelector:typeof n.webkitMatchesSelector!==w?s=n.webkitMatchesSelector:typeof n.mozMatchesSelector!==w?s=n.mozMatchesSelector:typeof n.oMatchesSelector!==w&&(s=n.oMatchesSelector),s.call(n,i)}function a(n){if(typeof n===k)return n.hasOwnProperty("element")&&n.hasOwnProperty("on")?n:null;var i=O.exec(n);if(!i)return null;var s=i[2];return"["===s[0]&&(s=s.substring(1,s.length-1)),{element:i[1],on:s}}function c(n,i){if(null===n||typeof n===w)return n;if(typeof n===k)return n;for(var s=n.split(" "),o={},a=i.length-1,c=s.length-1;c>=0;c--){if(0===a){o[i[a]]=s.slice(0,c+1).join(" ");break}o[i[a]]=s[c],a--}return o}var u=function(){function n(n,i){for(var s=0;s<i.length;s++){var o=i[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(i,s,o){return s&&n(i.prototype,s),o&&n(i,o),i}}(),l=function(n,i,s){for(var o=!0;o;){var a=n,c=i,u=s;o=!1,null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,c);if(void 0!==l){if("value"in l)return l.value;var p=l.get;if(void 0===p)return;return p.call(u)}var d=Object.getPrototypeOf(a);if(null===d)return;n=d,i=c,s=u,o=!0,l=d=void 0}},p=Tether.Utils,d=p.Evented,f=p.addClass,v=p.extend,y=p.hasClass,m=p.removeClass,g=p.uniqueId,b=new d,w="undefined",k="object",S={top:"bottom center",left:"middle right",right:"middle left",bottom:"top center",center:"middle center"},O=/^(.+) (top|left|right|bottom|center|\[[a-z ]+\])$/,x=function(p){function d(i,s){return n(this,d),l(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,i,s),this.tour=i,this.bindMethods(),this.setOptions(s),this}return i(d,p),u(d,[{key:"bindMethods",value:function(){var n=this,i=["_show","show","hide","isOpen","cancel","complete","scrollTo","destroy","render"];i.map(function(i){n[i]=n[i].bind(n)})}},{key:"setOptions",value:function(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=n,this.destroy(),this.id=this.options.id||this.id||"step-"+g();var i=this.options.when;if(i)for(var s in i)if({}.hasOwnProperty.call(i,s)){var o=i[s];this.on(s,o,this)}var a=JSON.stringify(this.options.buttons),c=a===w||"true"===a,u="{}"===a||"[]"===a||"false"===a;c?this.options.buttons=[{text:"Next",action:this.tour.next,classes:"btn"}]:u&&(this.options.buttons=!1)}},{key:"getTour",value:function(){return this.tour}},{key:"bindAdvance",value:function(){var n=this,i=c(this.options.advanceOn,["selector","event"]),s=i.event,a=i.selector,u=function(e){n.isOpen()&&(typeof a!==w?o(e.target,a)&&n.tour.next():n.el&&e.target===n.el&&n.tour.next())};document.body.addEventListener(s,u),this.on("destroy",function(){return document.body.removeEventListener(s,u)})}},{key:"getAttachTo",value:function(){var n=a(this.options.attachTo)||{},i=v({},n);return"string"==typeof n.element&&(i.element=document.querySelector(n.element),i.element||console.error("The element for this Shepherd step was not found "+n.element)),i}},{key:"setupTether",value:function(){if(typeof Tether===w)throw new Error("Using the attachment feature of Shepherd requires the Tether library");var n=this.getAttachTo(),i=S[n.on||"right"]||n.on;typeof n.element===w&&(n.element="viewport",i="middle center");var s={classPrefix:"shepherd",element:this.el,constraints:[{to:"window",pin:!0,attachment:"together"}],target:n.element,offset:n.offset||"0 0",attachment:i};this.tether&&this.tether.destroy(),this.tether=new Tether(v(s,this.options.tetherOptions))}},{key:"show",value:function(){var n=this;if(typeof this.options.beforeShowPromise!==w){var i=this.options.beforeShowPromise();if(typeof i!==w)return i.then(function(){return n._show()})}this._show()}},{key:"_show",value:function(){var n=this;this.trigger("before-show"),this.el||this.render(),f(this.el,"shepherd-open"),document.body.setAttribute("data-shepherd-step",this.id),this.setupTether(),this.options.scrollTo&&setTimeout(function(){n.scrollTo()}),this.trigger("show")}},{key:"hide",value:function(){this.trigger("before-hide"),m(this.el,"shepherd-open"),document.body.removeAttribute("data-shepherd-step"),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("hide")}},{key:"isOpen",value:function(){return this.el&&y(this.el,"shepherd-open")}},{key:"cancel",value:function(){this.tour.cancel(),this.trigger("cancel")}},{key:"complete",value:function(){this.tour.complete(),this.trigger("complete")}},{key:"scrollTo",value:function(){var n=this.getAttachTo(),i=n.element;typeof this.options.scrollToHandler!==w?this.options.scrollToHandler(i):typeof i!==w&&i.scrollIntoView()}},{key:"destroy",value:function(){typeof this.el!==w&&this.el.parentNode&&(this.el.parentNode.removeChild(this.el),delete this.el),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("destroy")}},{key:"render",value:function(){var n=this;typeof this.el!==w&&this.destroy(),this.el=s("<div class='shepherd-step "+(this.options.classes||"")+"' data-id='"+this.id+"' "+(this.options.idAttribute?'id="'+this.options.idAttribute+'"':"")+"></div>");var i=document.createElement("div");i.className="shepherd-content",this.el.appendChild(i);var o=document.createElement("header");if(i.appendChild(o),this.options.title&&(o.innerHTML+="<h3 class='shepherd-title'>"+this.options.title+"</h3>",this.el.className+=" shepherd-has-title"),this.options.showCancelLink){var a=s("<a href class='shepherd-cancel-link'>âœ•</a>");o.appendChild(a),this.el.className+=" shepherd-has-cancel-link",this.bindCancelLink(a)}typeof this.options.text!==w&&!function(){var o=s("<div class='shepherd-text'></div>"),a=n.options.text;"function"==typeof a&&(a=a.call(n,o)),a instanceof HTMLElement?o.appendChild(a):("string"==typeof a&&(a=[a]),a.map(function(n){o.innerHTML+="<p>"+n+"</p>"})),i.appendChild(o)}(),this.options.buttons&&!function(){var o=document.createElement("footer"),a=s("<ul class='shepherd-buttons'></ul>");n.options.buttons.map(function(i){var o=s("<li><a class='shepherd-button "+(i.classes||"")+"'>"+i.text+"</a>");a.appendChild(o),n.bindButtonEvents(i,o.querySelector("a"))}),o.appendChild(a),i.appendChild(o)}(),document.body.appendChild(this.el),this.setupTether(),this.options.advanceOn&&this.bindAdvance()}},{key:"bindCancelLink",value:function(n){var i=this;n.addEventListener("click",function(e){e.preventDefault(),i.cancel()})}},{key:"bindButtonEvents",value:function(n,i){var s=this;n.events=n.events||{},typeof n.action!==w&&(n.events.click=n.action);for(var o in n.events)if({}.hasOwnProperty.call(n.events,o)){var a=n.events[o];"string"==typeof a&&!function(){var n=a;a=function(){return s.tour.show(n)}}(),i.addEventListener(o,a)}this.on("destroy",function(){for(var s in n.events)if({}.hasOwnProperty.call(n.events,s)){var o=n.events[s];i.removeEventListener(s,o)}})}}]),d}(d),C=function(s){function o(){var i=this,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n(this,o),l(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,s),this.bindMethods(),this.options=s,this.steps=this.options.steps||[];var a=["complete","cancel","hide","start","show","active","inactive"];return a.map(function(n){!function(e){i.on(e,function(n){n=n||{},n.tour=i,b.trigger(e,n)})}(n)}),this}return i(o,s),u(o,[{key:"bindMethods",value:function(){var n=this,i=["next","back","cancel","complete","hide"];i.map(function(i){n[i]=n[i].bind(n)})}},{key:"addStep",value:function(n,i){return typeof i===w&&(i=n),i instanceof x?i.tour=this:(("string"==typeof n||"number"==typeof n)&&(i.id=n.toString()),i=v({},this.options.defaults,i),i=new x(this,i)),this.steps.push(i),this}},{key:"removeStep",value:function(n){for(var i=this.getCurrentStep(),s=0;s<this.steps.length;++s){var o=this.steps[s];if(o.id===n){o.hide(),o.destroy(),this.steps.splice(s,1);break}}i&&i.id===n&&(this.currentStep=void 0,this.steps.length?this.show(0):this.hide())}},{key:"getById",value:function(n){for(var i=0;i<this.steps.length;++i){var s=this.steps[i];if(s.id===n)return s}}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"next",value:function(){var n=this.steps.indexOf(this.currentStep);n===this.steps.length-1?(this.hide(n),this.trigger("complete"),this.done()):this.show(n+1,!0)}},{key:"back",value:function(){var n=this.steps.indexOf(this.currentStep);this.show(n-1,!1)}},{key:"cancel",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("cancel"),this.done()}},{key:"complete",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("complete"),this.done()}},{key:"hide",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("hide"),this.done()}},{key:"done",value:function(){b.activeTour=null,m(document.body,"shepherd-active"),this.trigger("inactive",{tour:this})}},{key:"show",value:function(){var n=arguments.length<=0||void 0===arguments[0]?0:arguments[0],i=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];this.currentStep?this.currentStep.hide():(f(document.body,"shepherd-active"),this.trigger("active",{tour:this})),b.activeTour=this;var s=void 0;if(s="string"==typeof n?this.getById(n):this.steps[n])if(typeof s.options.showOn===w||s.options.showOn())this.trigger("show",{step:s,previous:this.currentStep}),this.currentStep&&this.currentStep.hide(),this.currentStep=s,s.show();else{var o=this.steps.indexOf(s),a=i?o+1:o-1;this.show(a,i)}}},{key:"start",value:function(){this.trigger("start"),this.currentStep=null,this.next()}}]),o}(d);return v(b,{Tour:C,Step:x,Evented:d}),b});